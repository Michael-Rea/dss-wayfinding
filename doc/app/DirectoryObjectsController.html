<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">

<title>class DirectoryObjectsController - Rails Application Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-create">#create</a>
    
    <li ><a href="#method-i-departmentPlacards">#departmentPlacards</a>
    
    <li ><a href="#method-i-destroy">#destroy</a>
    
    <li ><a href="#method-i-generateQR">#generateQR</a>
    
    <li ><a href="#method-i-index">#index</a>
    
    <li ><a href="#method-i-personPlacard">#personPlacard</a>
    
    <li ><a href="#method-i-qr">#qr</a>
    
    <li ><a href="#method-i-search">#search</a>
    
    <li ><a href="#method-i-show">#show</a>
    
    <li ><a href="#method-i-unroutable">#unroutable</a>
    
    <li ><a href="#method-i-update">#update</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-DirectoryObjectsController">
  <h1 id="class-DirectoryObjectsController" class="class">
    class DirectoryObjectsController
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 125</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>
  <span class="ruby-ivar">@object</span> = <span class="ruby-identifier">params_type_as_constant</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">directory_object_params</span>)

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-constant">Authorization</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">loginid</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; created directory_object id: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; type: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">type</span>

      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@object</span> }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">message</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span> }, <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">405</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-departmentPlacards" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">departmentPlacards</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="departmentPlacards-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">departmentPlacards</span>
  <span class="ruby-ivar">@results</span> = []

  <span class="ruby-constant">Person</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;department_id =?&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">person</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">name</span>       = <span class="ruby-identifier">person</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">department</span> = <span class="ruby-identifier">person</span>.<span class="ruby-identifier">department</span>.<span class="ruby-identifier">name</span>
    <span class="ruby-identifier">title</span>      = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">roomNumber</span> = <span class="ruby-identifier">person</span>.<span class="ruby-identifier">rooms</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">room_number</span>
    <span class="ruby-keyword">rescue</span>
      <span class="ruby-identifier">roomNumber</span> = <span class="ruby-value">0</span>
      <span class="ruby-identifier">title</span> = <span class="ruby-string">&quot;please define a room number for this person&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">targetURL</span>   = <span class="ruby-identifier">url_for</span>(<span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;start&#39;</span>, <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;administration&#39;</span>, <span class="ruby-identifier">origin</span><span class="ruby-operator">:</span> <span class="ruby-identifier">roomNumber</span>)
    <span class="ruby-identifier">qrLink</span>     = <span class="ruby-identifier">generateQRLink</span>(<span class="ruby-identifier">targetURL</span>)

    <span class="ruby-identifier">hash</span> = {<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">department</span><span class="ruby-operator">:</span> <span class="ruby-identifier">department</span>, <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">title</span>, <span class="ruby-identifier">targetURL</span><span class="ruby-operator">:</span> <span class="ruby-identifier">targetURL</span>, <span class="ruby-identifier">qrLink</span><span class="ruby-operator">:</span> <span class="ruby-identifier">qrLink</span>}
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">hash</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">render</span> <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="destroy-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">present?</span> <span class="ruby-keyword">and</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;Room&#39;</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-constant">Authorization</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">loginid</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; deleted directory_object id: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; type: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>].<span class="ruby-identifier">singularize</span>.<span class="ruby-identifier">capitalize</span>

    <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> {<span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">message</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Object deleted successfully&quot;</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">id</span> }, <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">302</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">message</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Error destroying &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;.&quot;</span> }, <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">405</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-generateQR" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">generateQR</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Generate a QR for URL passed in as a param and then render it Intended
route to be used in an &lt;img&gt; tag Does not do any parsing or forming</p>
          
          

          
          <div class="method-source-code" id="generateQR-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">generateQR</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:url</span>]

  <span class="ruby-identifier">qrcode</span> = <span class="ruby-constant">RQRCode</span><span class="ruby-operator">::</span><span class="ruby-constant">QRCode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">url</span>)
  <span class="ruby-comment"># Preference on png or svg?</span>
  <span class="ruby-comment"># png = qrcode.as_png(</span>
  <span class="ruby-comment">#           resize_gte_to: false,</span>
  <span class="ruby-comment">#           resize_exactly_to: false,</span>
  <span class="ruby-comment">#           fill: &#39;white&#39;,</span>
  <span class="ruby-comment">#           color: &#39;black&#39;,</span>
  <span class="ruby-comment">#           size: 120,</span>
  <span class="ruby-comment">#           border_modules: 4,</span>
  <span class="ruby-comment">#           module_px_size: 6,</span>
  <span class="ruby-comment">#           file: nil</span>

  <span class="ruby-comment"># )</span>

  <span class="ruby-identifier">svg</span> = <span class="ruby-identifier">qrcode</span>.<span class="ruby-identifier">as_svg</span>(<span class="ruby-identifier">offset</span><span class="ruby-operator">:</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">color</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;000&#39;</span>,
                  <span class="ruby-identifier">shape_rendering</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;crispEdges&#39;</span>,
                  <span class="ruby-identifier">module_size</span><span class="ruby-operator">:</span> <span class="ruby-value">11</span>
  )

  <span class="ruby-identifier">send_data</span> <span class="ruby-identifier">svg</span>, <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;image/svg+xml&#39;</span>, <span class="ruby-identifier">disposition</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;inline&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>GET /directory_objects</p>
          
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-ivar">@type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Person&quot;</span>
    <span class="ruby-ivar">@directory_objects</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:last</span>)
    <span class="ruby-ivar">@scrubber_categories</span> = (<span class="ruby-string">&quot;A&quot;</span><span class="ruby-operator">..</span><span class="ruby-string">&quot;Z&quot;</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Department&quot;</span>
    <span class="ruby-ivar">@directory_objects</span> = <span class="ruby-constant">Department</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:title</span>)
    <span class="ruby-ivar">@scrubber_categories</span> = (<span class="ruby-string">&quot;A&quot;</span><span class="ruby-operator">..</span><span class="ruby-string">&quot;Z&quot;</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Event&quot;</span>
    <span class="ruby-ivar">@directory_objects</span> = <span class="ruby-constant">Event</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:title</span>)
    <span class="ruby-ivar">@scrubber_categories</span> = []
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Room&quot;</span>
    <span class="ruby-ivar">@directory_objects</span> = <span class="ruby-constant">Room</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:room_number</span>)
    <span class="ruby-ivar">@scrubber_categories</span> = [<span class="ruby-string">&#39;L&#39;</span>,<span class="ruby-value">1</span>,<span class="ruby-value">2</span>,<span class="ruby-value">3</span>,<span class="ruby-value">4</span>,<span class="ruby-value">5</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># Unsupported behavior</span>
    <span class="ruby-ivar">@directory_objects</span> = []
    <span class="ruby-ivar">@scrubber_categories</span> = []
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@directory_objects</span> = <span class="ruby-ivar">@directory_objects</span>.<span class="ruby-identifier">uniq</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-personPlacard" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">personPlacard</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="personPlacard-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">personPlacard</span>
  <span class="ruby-identifier">person</span>      = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;id =?&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]).<span class="ruby-identifier">first</span>
  <span class="ruby-ivar">@name</span>       = <span class="ruby-identifier">person</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-ivar">@department</span> = <span class="ruby-identifier">person</span>.<span class="ruby-identifier">department</span>.<span class="ruby-identifier">name</span>
  <span class="ruby-ivar">@title</span>      = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">targetURL</span>   = <span class="ruby-identifier">url_for</span>(<span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;start&#39;</span>, <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;administration&#39;</span>, <span class="ruby-identifier">origin</span><span class="ruby-operator">:</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">rooms</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">room_number</span>)
  <span class="ruby-ivar">@qrLink</span>     = <span class="ruby-identifier">generateQRLink</span>(<span class="ruby-identifier">targetURL</span>)

  <span class="ruby-identifier">render</span> <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-qr" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">qr</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Accepts either a single room ID (Assumed to be an origin)</p>

<pre>or 2 Room IDs (assumed to be an origin destination pair)
and will generate the view to display the corresponding qr code</pre>

<p>Target URL is the URL the QR points to qrLink links to the generateQR view
which will render the actual QR PNG converts room ID to room Number (This
is what start method expects)</p>
          
          

          
          <div class="method-source-code" id="qr-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">qr</span>
  <span class="ruby-ivar">@qrLink</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@targetURL</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">originRoom</span> = <span class="ruby-constant">Room</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;id=?&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:originID</span>]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">room_number</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:destinationID</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-comment"># Origin and destination supplied</span>
    <span class="ruby-identifier">destinationRoom</span> = <span class="ruby-constant">Room</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;id=?&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:destinationID</span>]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">room_number</span>
    <span class="ruby-ivar">@targetURL</span> = <span class="ruby-identifier">root_url</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;start/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">originRoom</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/end/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">destinationRoom</span> <span class="ruby-comment"># Hardcoding this for now because it&#39;s weird</span>
    <span class="ruby-ivar">@qrLink</span> = <span class="ruby-identifier">generateQRLink</span>(<span class="ruby-ivar">@targetURL</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@targetURL</span> = <span class="ruby-identifier">url_for</span>(<span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;start&#39;</span>, <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;administration&#39;</span>, <span class="ruby-identifier">origin</span><span class="ruby-operator">:</span> <span class="ruby-identifier">originRoom</span>)
    <span class="ruby-ivar">@qrLink</span> = <span class="ruby-identifier">generateQRLink</span>(<span class="ruby-ivar">@targetURL</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">render</span> <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> <span class="ruby-comment"># Stop application layout from displaying</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>POST /directory/search</p>
          
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 165</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search</span>
  <span class="ruby-ivar">@query</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:q</span>]

  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@query</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">objects</span> = <span class="ruby-constant">DirectoryObject</span>.<span class="ruby-identifier">arel_table</span>

    <span class="ruby-identifier">query_objs</span> = <span class="ruby-ivar">@query</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\s+/</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
      <span class="ruby-node">&quot;%#{q}%&quot;</span>
    }
    <span class="ruby-identifier">query_objs</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;%#{params[:q]}%&quot;</span>)

    <span class="ruby-identifier">query</span> = <span class="ruby-identifier">query_objs</span>.<span class="ruby-identifier">reduce</span>(<span class="ruby-string">&quot;&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">qry</span>,<span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">qry</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">Grouping</span>)
          <span class="ruby-identifier">new_qry</span> = <span class="ruby-identifier">objects</span>[<span class="ruby-value">:first</span>].<span class="ruby-identifier">matches</span>(<span class="ruby-identifier">obj</span>)
      <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">new_qry</span> = <span class="ruby-identifier">qry</span>.<span class="ruby-identifier">or</span>(<span class="ruby-identifier">objects</span>[<span class="ruby-value">:first</span>].<span class="ruby-identifier">matches</span>(<span class="ruby-identifier">obj</span>))
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">new_qry</span>.<span class="ruby-identifier">or</span>(<span class="ruby-identifier">objects</span>[<span class="ruby-value">:last</span>].<span class="ruby-identifier">matches</span>(<span class="ruby-identifier">obj</span>))
         .<span class="ruby-identifier">or</span>(<span class="ruby-identifier">objects</span>[<span class="ruby-value">:title</span>].<span class="ruby-identifier">matches</span>(<span class="ruby-identifier">obj</span>))
         .<span class="ruby-identifier">or</span>(<span class="ruby-identifier">objects</span>[<span class="ruby-value">:email</span>].<span class="ruby-identifier">matches</span>(<span class="ruby-identifier">obj</span>))
         .<span class="ruby-identifier">or</span>(<span class="ruby-identifier">objects</span>[<span class="ruby-value">:name</span>].<span class="ruby-identifier">matches</span>(<span class="ruby-identifier">obj</span>))
         .<span class="ruby-identifier">or</span>(<span class="ruby-identifier">objects</span>[<span class="ruby-value">:room_number</span>].<span class="ruby-identifier">matches</span>(<span class="ruby-identifier">obj</span>))
    }

    <span class="ruby-ivar">@directory_objects</span> = <span class="ruby-constant">DirectoryObject</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">query</span>)

    <span class="ruby-ivar">@directory_objects</span> = <span class="ruby-ivar">@directory_objects</span>.<span class="ruby-identifier">uniq</span>

    <span class="ruby-comment"># Remove special characters</span>
    <span class="ruby-identifier">clean_query</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:q</span>].<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/[^0-9A-Za-z\s]/</span>, <span class="ruby-string">&#39;&#39;</span>)

    <span class="ruby-identifier">terms_list</span> = <span class="ruby-identifier">clean_query</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\s+/</span>)

    <span class="ruby-identifier">terms_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">term</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">term_log</span> = <span class="ruby-constant">SearchTermLog</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">term</span><span class="ruby-operator">:</span> <span class="ruby-identifier">term</span>).<span class="ruby-identifier">first_or_create</span>
      <span class="ruby-identifier">term_log</span>.<span class="ruby-identifier">count</span> = <span class="ruby-identifier">term_log</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">term_log</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># No results were found, log the query</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@directory_objects</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-constant">UnmatchedQueryLog</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">query</span><span class="ruby-operator">:</span> <span class="ruby-identifier">clean_query</span>).<span class="ruby-identifier">first_or_create</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-show" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>GET /directory_objects/1 GET /room/1 GET /start/R0070/end/R2169 GET
/start/R0070/directory/1234</p>
          
          

          
          <div class="method-source-code" id="show-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 236</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@object</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unroutable" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unroutable</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="unroutable-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 217</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unroutable</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:from</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:to</span>]
    <span class="ruby-identifier">head</span> <span class="ruby-value">405</span>, <span class="ruby-identifier">content_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;text/html&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">unroutable_route</span> = <span class="ruby-constant">UnroutableLog</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">from</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:from</span>], <span class="ruby-identifier">to</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:to</span>]).<span class="ruby-identifier">first_or_create</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">unroutable_route</span>
    <span class="ruby-identifier">unroutable_route</span>.<span class="ruby-identifier">hits</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">unroutable_route</span>.<span class="ruby-identifier">hits</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">unroutable_route</span>.<span class="ruby-identifier">hits</span> = <span class="ruby-value">1</span>
    <span class="ruby-identifier">unroutable_route</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">head</span> <span class="ruby-value">:ok</span>, <span class="ruby-identifier">content_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;text/html&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="update-source">
            <pre><span class="ruby-comment"># File app/controllers/directory_objects_controller.rb, line 139</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">directory_object_params</span>)
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-constant">Authorization</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">loginid</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; updated directory_object id: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; type: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">type</span>

      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@object</span> }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">message</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span> }, <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">405</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

