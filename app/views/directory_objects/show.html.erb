<script type="text/javascript">
  // Redirect to home page after a certain period has elapsed
  setRedirectToHome();

  $(function() {
    resizeIcons();

    $('a.btn-home').click(function(e) {
      e.preventDefault();

      var anchor = $(this), h;
      h = anchor.attr('href');

      $('ul.vertical-nav').animate({left: '-200%'}, 500, function() {
        window.location = h;
      })
    });
  });

  function showInfo() {
    $('#destination-view').css('right', 0);
  }

  ready = function() {
    <% if @origin %>
      var destination;

      $(document).on("wayfinding:floorChanged", function(e, data) {
        console.log("Wayfinding indicates the floor has changed during an animation. Floor: " + data.map_id);
        // Make the corresponding floor button active
        $("a.btn-floor").removeClass('active');
        $($('a.btn-floor[data-mapId="' + data.map_id + '"]')[0]).addClass('active')
      });

      $(document).on("wayfinding:roomClicked", function(e, data) {
        console.log("Wayfinding indicates a room was clicked. Room: " + data.room_id);
        destination = data.room_id;
      });

      $(document).on("wayfinding:animationComplete", function(e, data) {
        console.log("Wayfinding indicates animation is complete.");
      });

      $(document).on("wayfinding:ready", function() {
        setTimeout( showInfo(), 3000 );

        $($('a.btn-floor[data-mapId="floor1"]')[0]).addClass('active')

        destination = '<%= @destination %>';
        if (destination.length > 0) {
          console.debug("destination = ",destination);
          $('#map').wayfinding('routeTo', destination);
        }

        $('.replay').click(function(e) {
          e.preventDefault();
          if (destination.length > 0)
            $('#map').wayfinding('routeTo', destination);
         })

         //toggle accessibleRoute
        $('.accessible').click(function(e) {
          e.preventDefault();
          if (destination.length > 0)
            console.debug('Making accessible');
            $('a.accessible').toggleClass('active');
            $('#map').wayfinding('accessibleRoute', !$('#map').wayfinding('accessibleRoute'));
         })
      });

    <%
      @svg_paths = [asset_path("ssh_floor_0.svg"),
                    asset_path("ssh_floor_1.svg"),
                    asset_path("ssh_floor_2.svg"),
                    asset_path("ssh_floor_3.svg"),
                    asset_path("ssh_floor_4.svg"),
                    asset_path("ssh_floor_5.svg")]
    %>
    <%= wayfinding_plugin(@svg_paths, asset_path("dataStore-" + @origin + ".json"), @origin) %>
    <% else %>
      $("#mapLoadingInner").css("top", "30%");
      $("#mapLoadingInner").html("Uh oh! Kiosk/QR location unset.");

    <% end %>
  };

  $(document).ready(ready);

  $(document).on("page:load", ready);

</script>


<div class="row">
  <div class="col-xs-9 show-map">
    <ul class="horizontal-nav map-actions">
      <span>Floors</span>
      <li><a href="#" data-mapId="floor0" class="btn-floor">L</a></li>
      <li><a href="#" data-mapId="floor1" class="btn-floor">1</a></li>
      <li><a href="#" data-mapId="floor2" class="btn-floor">2</a></li>
      <li><a href="#" data-mapId="floor3" class="btn-floor">3</a></li>
      <li><a href="#" data-mapId="floor4" class="btn-floor">4</a></li>
      <li><a href="#" data-mapId="floor5" class="btn-floor">5</a></li>
    </ul>
    <div id="map">
      <div id="mapLoading">
        <div id="mapLoadingInner">
          <%= image_tag("loader.gif", alt: "Loading") %>
        </div>
      </div>
    </div> <!-- #map -->
    <ul class="horizontal-nav map-actions">
      <li><a href="#" class="btn-map-action icon-accessible accessible"></a></li>
      <li><a href="#" class="btn-map-action icon-repeat replay"></a></li>
    </ul>
  </div> <!-- .show-map -->

  <% if @directory_object %>
  <div id="destination-view" class="text-<%= @directory_object.type.pluralize.downcase %>">

    <h1 class="btn-<%= @directory_object.type.pluralize.downcase %>">Destination</h1>

    <% if @directory_object.type == "Person" %>
      <% if @directory_object.rooms.present? %>
      <h2>Room </h2>
      <span><%= @directory_object.rooms.first.room_number %></span>
      <% end %>

      <% if @directory_object.first.present? %>
      <h2>Name </h2>
      <span><%= @directory_object.first + " " + @directory_object.last %></span>
      <% end %>

      <% if @directory_object.email.present? %>
      <h2>Email </h2>
        <%= mail_to @directory_object.email do %>
        <span><%= @directory_object.email %></span>
        <% end %>
      <% end %>

      <% if @directory_object.phone.present? %>
      <h2>Phone </h2>
      <span><%= @directory_object.phone %></span>
      <% end %>

      <% if @directory_object.department.present? %>
      <h2>Search Similar</h2>
      <a href="/directory?search=<%= @directory_object.department.title %>">
        <span class="label label-default btn-departments">
          <%= @directory_object.department.title.titleize %>
        </span>
      </a>
      <% end %>
    <% end %>

    <% if @directory_object.type == "Room" %>
      <% if @directory_object.room_number.present? %>
      <h2>Room </h2>
      <span><%= @directory_object.room_number %></span>
      <% end %>

      <% if @directory_object.name.present? %>
      <h2>Name </h2>
      <span><%= @directory_object.name %></span>
      <% end %>
    <% end %>

    <% if @directory_object.type == "Department" %>
      <% if @directory_object.title.present? %>
      <h2>Title</h2>
      <span><%= @directory_object.title %></span>
      <% end %>

      <h2>Search Similar</h2>
      <a href="/directory?search=<%= @directory_object.title %>">
        <span class="label label-default btn-departments">
          <%= @directory_object.title.titleize %>
        </span>
      </a>
    <% end %>

    <% if @directory_object.type == "Event" %>
      <% if @directory_object.title.present? %>
          <h2>Title </h2>
          <span><%= @directory_object.title %></span>
      <% end %>

      <% if @directory_object.room.present? %>
      <h2>Room </h2>
      <span><%= @directory_object.room.room_number %></span>
      <% end %>

      <% if @directory_object.time.present? %>
      <h2>Time </h2>
      <span><%= @directory_object.time %></span>
      <% end %>

      <% if @directory_object.link.present? %>
      <h2>Link </h2>
      <span><a href="<%= @directory_object.link %>">Event Link</span></a>
      <% end %>

      <% if @directory_object.department.present? %>
      <h2>Department </h2>
      <span><%= @directory_object.department.title.titleize %></span>

      <h2>Search Similar</h2>
      <a href="/directory?search=<%= @directory_object.department.title %>">
        <span class="label label-default btn-departments">
          <%= @directory_object.department.title.titleize %>
        </span>
      </a>
      <% end %>
    <% end %>

  </div> <!-- destination-view -->
  <% end %>
</div> <!-- row -->
