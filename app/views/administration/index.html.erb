<%= javascript_include_tag 'application', 'admin', 'data-turbolinks-track' => true %>
<script type="text/javascript">
  var notice = "<%= params[:notice] %>";
  var error = "<%= params[:error] %>";
</script>

<h1 id="directory-title">Administration</h1>

<div class="row cache-building hidden">
  <div class="col-sm-3 text-right">
    Cache building progress
  </div>
  <div class="col-sm-7">
    <div class="progress">
      <div id="cache-progress" class="progress-bar" role="progressbar" style="width: 100%;">
        No cache building in porgress
      </div>
    </div>
  </div>
</div>

<div class="admin-view">
  <div class="alert" role="alert">
    <span class="notice"></span>
  </div> <!-- .alert -->

  <div role="tabpanel" class="tabs-left" id="admin-menu">

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active">
        <a href="#kiosk" aria-controls="kiosk" role="tab" data-toggle="tab">Set Kiosk Location</a>
      </li>
      <li role="presentation">
        <a href="#svg" aria-controls="svg" role="tab" data-toggle="tab">Manage SVG Maps</a>
      </li>
      <li role="presentation">
        <a href="#csv" aria-controls="csv" role="tab" data-toggle="tab">Upload New Facilities CSV</a>
      </li>
      <li role="presentation">
        <a href="#rss" aria-controls="rss" role="tab" data-toggle="tab">Manage RSS Fetching</a>
      </li>
      <li role="presentation">
        <a href="#unmatched" aria-controls="unmatched" role="tab" data-toggle="tab">Unmatched Search Query Logs</a>
      </li>
      <li role="presentation">
        <a href="#search-logs" aria-controls="search-logs" role="tab" data-toggle="tab">Search Term Logs</a>
      </li>
      <li role="presentation">
        <a href="#dept" aria-controls="dept" role="tab" data-toggle="tab">Edit Department Locations</a>
      </li>
      <li role="presentation">
        <a href="#people" aria-controls="people" role="tab" data-toggle="tab">Edit People Directory</a>
      </li>
      <li role="presentation">
        <a href="#rooms" aria-controls="rooms" role="tab" data-toggle="tab">Edit Rooms Directory</a>
      </li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="kiosk">
        <%= form_tag(origin_administration_index_path, id: "originform", remote: true, class: 'form-inline') do %>
          <div class="form-group">
            <%= text_field_tag :origin, @origin, placeholder: 'Example: R1152', class: 'form-control start' %>
          </div>
          <%= submit_tag 'Set Location', class: 'btn btn-default' %>
        <% end %>
      </div>

      <div role="tabpanel" class="tab-pane" id="svg">
        <%= form_tag(map_upload_administration_index_path,
          multipart: true, remote: true, class: 'form-horizontal', id: 'svg-upload-form') do %>
          <% (0..5).each do |f| %>
            <div class="form-group">
              <%= label_tag 'Floor ' + f.to_s, nil, class: 'col-sm-2 control-label' %>
              <div class="col-sm-10">
                <%= file_field_tag "uploaded_map[#{f.to_s}]", class: 'form-control', :accept => 'image/svg+xml' %>
              </div>
            </div>
          <% end %>
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-1">
              <%= submit_tag 'Upload', class: 'btn btn-default' %>
            </div>
            <div class="col-sm-9">
              <div class="cache-stats text-right">
                No cache building in porgress
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <div role="tabpanel" class="tab-pane" id="csv">
        <%= form_tag(csv_administration_index_path, multipart: true, remote: true, class: 'form-inline') do %>
          <div class="form-group">
            <%= file_field_tag :uploaded_csv, class: 'form-control start' %>
          </div>
          <%= submit_tag 'Upload', class: 'btn btn-default' %>
          <%= link_to " FacilitiesLink",
            "https://ucdavis.metabim.com/Buildings/Home/Managers/Managers.csv?Bkey=1066",
            :target => "_blank", :class => "pull-right btn" %>
        <% end %>
      </div>

      <div role="tabpanel" class="tab-pane" id="rss">
        <table class="table">
          <thead>
            <tr>
              <th>Feed URL</th>
              <th></th>
            </tr>
          </thead>

          <tbody>
            <% @rss_feeds.each do |rss_feed| %>
              <tr>
                <td><%= rss_feed.url %></td>
                <td><%= link_to 'Remove', rss_feed, method: :delete, data: { confirm: 'Are you sure?' } %></td>
              </tr>
            <% end %>
              <tr>
                <%= form_for(@rss_feed, remote: false, class: 'form-inline') do |f| %>
                <td>
                  <%= f.text_field :url, class: "form-control" %>
                </td>
                <td>
                  <%= f.submit "Add Feed", class: "btn btn-default" %>
                </td>
                <% end %>
              </tr>
          </tbody>
        </table>
      </div>

      <div role="tabpanel" class="tab-pane" id="unmatched">
        <% @unmatched_queries.each do |query| %>
          <div class="col-sm-2">
            <%= query.query %>
          </div>
        <% end %>
      </div>

      <div role="tabpanel" class="tab-pane" id="search-logs">
        <div class="row" style="margin-top: 1em;">
          <div class="col-sm-2">
            Search Term - Number of occurences (Top 30)
          </div>
          <% @search_terms.each do |search_term| %>
            <div class="col-sm-2">
              <%= search_term.term %> - <%= search_term.count %>
            </div>
          <% end %>
        </div> <!-- .row -->
      </div>

      <div role="tabpanel" class="tab-pane" id="dept">
        <% @departments.each do |department| %>
          <%= form_tag(department_location_administration_index_path, class: "deptform form-horizontal", remote: true) do %>
          <div class="form-group">

            <label for="department" class="col-sm-3 control-label"><%= department.title %></label>
            <div class="col-sm-2">
            <% if department.room %>
            <%= text_field_tag :department_room_number, department.room.room_number, placeholder: department.inspect, class: 'form-control' %>
            <% else %>
            <%= text_field_tag :department_room_number, nil, placeholder: 'Room Number', class: 'form-control' %>
            <% end %>
            <%= hidden_field_tag :department_id, department.id %>
            </div>
            <div class="col-sm-2">
            <%= submit_tag 'Save Location', class: 'btn btn-default' %>
            </div>
          </div>
          <% end %>
        <% end %>
      </div>

      <div role="tabpanel" class="tab-pane" id="people">
        <div class="list-group col-sm-3 admin-directory-list">
          <%= search_field_tag "search-people", nil, placeholder: 'Search People', class: 'form-control' %>
          <a href="#" class="list-group-item list-group-item-success active" id="new-person">New Person</a>
          <% @people.each do |person| %>
            <a href="#" class="list-group-item person-item" id="person_<%= person.id %>">
              <%= person.first + " " + person.last %></a>
          <% end %>
        </div>
        <div class="col-sm-9">
        <%= form_tag directory_object_administration_index_path,
        remote: true, class: 'form-horizontal', id: 'people-form' do %>
          <%= hidden_field_tag 'id' %>
          <div class="form-group">
            <%= label_tag 'Name', nil, class: 'col-sm-2 control-label' %>
            <div class="col-sm-5">
              <%= text_field_tag "first", nil, placeholder: 'First Name', class: 'form-control' %>
            </div>
            <div class="col-sm-5">
              <%= text_field_tag "last", nil, placeholder: 'Last Name', class: 'form-control' %>
            </div>
          </div>
          <div class="form-group">
            <%= label_tag 'Email', nil, class: 'col-sm-2 control-label' %>
            <div class="col-sm-10">
              <%= text_field_tag "email", nil, placeholder: 'Email', class: 'form-control' %>
            </div>
          </div>
          <div class="form-group">
            <%= label_tag 'Phone', nil, class: 'col-sm-2 control-label' %>
            <div class="col-sm-10">
              <%= text_field_tag "phone", nil, placeholder: 'Phone', class: 'form-control' %>
            </div>
          </div>
          <div class="form-group">
            <%= label_tag 'Department', nil, class: 'col-sm-2 control-label' %>
            <div class="col-sm-10">
              <%= select_tag "department", options_from_collection_for_select(@departments, "id", "title"), include_blank: true, class: 'form-control' %>
            </div>
          </div>
          <div class="form-group">
            <%= label_tag 'Rooms', nil, class: 'col-sm-2 control-label' %>
            <div class="col-sm-10">
              <%= select_tag "rooms", options_from_collection_for_select(@rooms, "id", "room_number"), multiple: true, class: 'form-control' %>
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-1">
              <%= submit_tag 'Create', class: 'btn btn-default' %>
            </div>
          </div>
        <% end %>
      </div>
      </div>

      <div role="tabpanel" class="tab-pane" id="rooms">
        <% @departments.each do |department| %>
          <%= form_tag(department_location_administration_index_path, class: "deptform form-horizontal", remote: true) do %>
          <div class="form-group">

            <label for="department" class="col-sm-3 control-label"><%= department.title %></label>
            <div class="col-sm-2">
            <% if department.room %>
            <%= text_field_tag :department_room_number, department.room.room_number, placeholder: department.inspect, class: 'form-control' %>
            <% else %>
            <%= text_field_tag :department_room_number, nil, placeholder: 'Room Number', class: 'form-control' %>
            <% end %>
            <%= hidden_field_tag :department_id, department.id %>
            </div>
            <div class="col-sm-2">
            <%= submit_tag 'Save Location', class: 'btn btn-default' %>
            </div>
          </div>
          <% end %>
        <% end %>
      </div>

    </div>

  </div>
</div> <!-- .admin-view -->
